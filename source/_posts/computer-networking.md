---
title: 计算机网络
date: 2022-11-09 21:37:43
categories: 
 - 学习
---

# 一、基础

## 1.1 计算机网络体系结构

计算机网络体系结构，一般有三种：OSI 七层结构、TCP/IP 五层结构

[](/img/computer-networking/structure.png)

1. 应用层HTTP：应用层决定了向用户提供应用服务时通信的活动。（HTTP、DNS、FTP）

2. 传输层TCP 通信端口：（TCP）为应用层实体提供端到端的通信功能，建立处于网络连接中两台计算机之间的数据传输，保证数据包的顺序传送及数据的完整性。传输层则要负责把数据包传给应⽤，但是⼀台设备上可能会有很多应⽤在接收或者传输数据，因此需要⽤⼀个编号将应⽤区分开来，这个编号就是端⼝。


3. 网络层IP（网络地址）: 网络上有大量节点和路径，网络层负责为在网络上流动的数据包根据其目标地址，选择数据包的下一个目的地以及前往的路径，**数据包**是网络传输的最小数据单位。

规定了通过怎样的路径到达对方计算机，并把数据包传送给对方。（IP、ARP）IP 协议的寻址作⽤是告诉我们去往下⼀个⽬的地该朝哪个⽅向⾛，路由则是根据「下⼀个⽬的地」选择路径。寻址更像在导航，路由更像在操作⽅向盘


4. 链路层：MAC地址、路由器（设备实体） 主要为⽹络层提供链路级别传输的服务， 跨网络传输时 每⼀台设备的⽹卡都会有⼀个 MAC 地址，它就是⽤来唯⼀标识设备的。路由器计算出了下⼀个⽬的地 IP 地址，再通过 ARP 协议找到该⽬的地的 MAC 地址，这样就知道这个 IP 地址是哪个设备的了。

数据链路层把网络层传下来的分组封装成帧。


5. 物理层BIT:网络中数据的传输，最终都需要通过在**物理介质**中传输，物理层提供把数据转换成电信号进行⼆进制BIT传输的服务。

考虑的是怎样在传输媒体上传输数据比特流，而不是指具体的传输媒体。物理层的作用是尽可能屏蔽传输媒体和通信手段的差异，使数据链路层感觉不到这些差异。

## 1.2 每一层对应的网络协议有哪些？

[](/img/computer-networking/proto.png)

## 1.2 数据在各层之间是怎么传输的?

对于发送方而言，从上层到下层, 层层包装，对于接收方而言，从下层到上层，层层解开包装。

[](/img/computer-networking/transportation.png)

图中的5,4,3,2,1 分别代表TCP/IP协议的应用层、传输层、网络层、数据链路层、物理层，h5,h4,h3,h2代表相应层的控制信息。

这张图展示的是AP1进程向AP2进程传送数据。首先AP1先将数据交给本主机的应用层(第5层)，然后第五层加上必要的控制信息就变成了第四层的数据单元。然后第四层再加上必要的控制信息就变成了第三层的数据单元，以此类推直到第二层(数据链路层)，控制信息变成了首部H2(MAC头地址信息)和尾部T2(FCS:帧校验序列)。 当数据离开路由器到达AP2时，就和上面一样，以此向上最终将数据发送到进程AP2。

* 发送方的应用进程向接收方的应用进程传送数据
* AP先将数据交给本主机的应用层，应用层加上本层的控制信息H5就变成了下一层的数据单元
* 传输层收到这个数据单元后，加上本层的控制信息H4，再交给网络层，成为网络层的数据单元
* 到了数据链路层，控制信息被分成两部分，分别加到本层数据单元的首部（H2）和尾部（T2）
* 最后的物理层，进行比特流的传输

# 二、 TCP



# 三、 IP

# 四、 HTTP/ HTTPS

## 4.1 HTTP 基本特性 80

HTTP 超⽂本传输协议

特性：简单、灵活、易于扩展、应用广泛和可以跨平台传输。

1. 简单:
基本报文格式为header＋body，头部信息也是key—value简单文本的形式，易于理解

2. 灵活、易于扩展:
HTTP协议里的各种请求方法、URI／URL、状态码、头字段等每个组成要求都没有被固定死，都允许开发人员自定义和扩充；

3. 无状态：
服务器不会去记忆HTTP的状态，每个请求都是独立的。所以不需要额外的资源来记录状态信息，这能减轻服务器的负担。但它在完成有会话交互性的操作时会非常麻烦。

比如当浏览器第一次发送请求给服务器时，服务器响应了；如果同个浏览器发起第
二次请求给服务器时，它还是会响应，但是呢，服务器不知道你就是刚才的那个浏
览器。

4. 明文传输：
传输过程中的信息，是可方便阅读的，通过浏览器的F12控制台或抓包都可以直接肉眼查看为我们调试工作带来了极大的便利性，但信息透明，容易被窃取。

5. 不安全：
 1．通信使用明文（不加密），内容可能被窃听
 2．不验证通信方的身份，因此有可能遭遇伪装
 3．无法证明报文的完整性，所以有可能已遭篡改。
可以用HTTPS的方式解决，也就是通过引入SSL／TLS层，使得在安全上达到了极致。

## 4.2 HTTPS基本特性 443 = HTTP + 密文 + 验证 + 完整性

HTTPS 超⽂本安全传输协议 

HTTP：以明文的方式在网络中传输数据

HTTPS解决HTTP不安全的缺陷，在TCP和HTTP网络层之间加入了SSL／TLS安全协议，使得报文能够加密传输。

HTTPS在TCP三次握手之后，还需进行SSL／TLS的握手过程，才可进入加密报文传输。HTTP的端口号是80，HTTPS的端口号是443。

HTTPS 协议需要向CA（证书权威机构）申请数字证书，来保证服务器的身份是可信的。
1. 特点：
 - 信息加密：交互信息无法被窃取
 - 校验机制：无法篡改通信内容，篡改了就不能正常显示
 - 身份证书：证明报文的完整

2. 优点
 - 在数据传输过程中，使用秘钥加密，安全性更高
 - 可认证用户和服务器，确保数据发送到正确的用户和服务器

3. 缺点
 - 握手阶段延时较高：在会话前还需进行SSL握手
 - 部署成本高：需要购买CA证书；需要加解密计算，占用CPU资源，需要服务器配置或数目高
 
4. 加密方式
    1. 对称加密：
    只使用一个密钥，运算速度快，密钥必须保密，无法做到安全的密钥交换；

    2. 非对称加密：
    使用两个密钥，公钥可以任意分发而私钥保密，解决密钥交换问题，但速度慢。

    3. 混合加密：
    实现信息的机密性，解决窃听风险；

HTTPS采用对称加密和非对称加密结合的［混合加密］方式。

### 4.2.5 HTTPS 工作加解密流程

[](/img/computer-networking/https.png)

1. 客户端发起 HTTPS 请求，连接到服务端的 443 端口。
2. 服务端有一套数字证书（证书内容有公钥、证书颁发机构、失效日期等）。
3. 服务端将自己的数字证书发送给客户端（公钥在证书里面，私钥由服务器持有）。
4. 客户端收到数字证书之后，会验证证书的合法性。如果证书验证通过，就会生成一个随机的对称密钥，用证书的公钥加密。
5. 客户端将公钥加密后的密钥发送到服务器。
6. 服务器接收到客户端发来的密文密钥之后，用自己之前保留的私钥对其进行非对称解密，解密之后就得到客户端的密钥，然后用客户端密钥对返回数据进行对称加密，酱紫传输的数据都是密文啦。
7. 服务器将加密后的密文返回到客户端。
8. 客户端收到后，用自己的密钥对其进行对称解密，得到服务器返回的数据。

## 4.3 HTTP 请求和响应的报文组成、方法、状态码

请求行 + 请求头Header + 请求体Body
```
1、请求行:（请求方法； URL；协议版本号）
* 请求方法: GET, POST, PUT, DELETE, PATCH, HEAD, OPTIONS, TRACE 
* 协议版本号： HTTP版本号
例如： POST  /chapter17/user.html  HTTP/1.1

2、请求头：包含请求的附加信息，有key： value组成

3、请求体：承载多个请求参数的数据。含回车、换行和请求数据（并非都有）
```

服务器处理请求并返回HTTP报文
```
响应报文主要由响应行、响应头和响应主体构成。
1、相应行: （协议版本；状态码；状态码描述）
2、状态码规则
200：客户端请求成功
206：partial content服务器已经正确处理部分GET请求，实现断点续传或同时分片下载，该请求必须包含Range请求头来指示客户端期望得到的范围
301（永久重定向）：该资源已被永久移动到新位置，将来任何对该资源的访问都要使用本响应返回的若干个URL之一
302（临时重定向）：请求的资源现在临时从不同的URI中获得
304：如果客户端发送一个待条件的GET请求并且该请求以经被允许，而文档内容未被改变，则返回304，该响应不
包含包体（即可直接使用缓存）
400：请求报文语法有误，服务器无法识别
401：请求需要认证
403：请求的对应资源禁止被访问
404：服务器无法找到对应资源
500：服务器内部错误
503：服务器正忙
```



# 五、网络综合

## 2.1 Socket 套接字, 类似特殊的IO流(网络数据)

IO 文件流的读写 <-----> Socket 网络通信中数据流的发送与接收

Socket 一个是 网编编程的标准接口。具体来说，Socket 是一套标准，它完成了对 TCP/IP 的高度封装，屏蔽网络细节，以方便开发者更好地进行网络编程。

具体的网络进程通信中，需要确定进程间通信使用的 IP 地址 + 端口 + 协议，三者组合起来就可以称为一个Socket, 利用这个Socket提供的各种函数如:connect、bind、listen、close、accept等函数，来实现网络中进程之间的通信。


